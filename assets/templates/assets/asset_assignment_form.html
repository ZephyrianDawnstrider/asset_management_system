{% extends 'assets/base.html' %}

{% block title %}Asset Management{% endblock %}

{% block content %}
<div class="bg-white rounded-xl shadow-2xl p-8">
    <h1 class="text-3xl font-bold text-gray-800 mb-6">Asset Management</h1>

    <!-- Add New Asset Form -->
    <div class="mb-12">
        <h3 class="text-2xl font-bold text-gray-800 mb-4">Add New Asset (Unassigned)</h3>
        <p class="text-gray-600 mb-6">Create a new asset that will be added to the unassigned pool.</p>
        
        <form method="post" class="space-y-6 p-6 bg-gray-50 rounded-lg border border-gray-200">
            {% csrf_token %}
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="id_asset_type" class="block text-sm font-medium text-gray-700">Asset Type</label>
                    <select name="{{ form.asset_type.html_name }}" id="id_asset_type" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-600 focus:border-blue-600" required>
                        <option value="">Select Asset Type</option>
                        {% for asset_type in asset_types %}
                            <option value="{{ asset_type.id }}" data-label="{{ asset_type.identification_type_label }}">{{ asset_type.name }}</option>
                        {% endfor %}
                    </select>
                    {% if form.asset_type.errors %}
                        <div class="text-red-600 text-sm mt-1">{% for error in form.asset_type.errors %}{{ error }}{% endfor %}</div>
                    {% endif %}
                </div>

                <div>
                    <label for="{{ form.asset_name.id_for_label }}" class="block text-sm font-medium text-gray-700">Asset Name (Human Name)</label>
                    <input id="{{ form.asset_name.id_for_label }}" name="{{ form.asset_name.html_name }}" type="text" value="{{ form.asset_name.value|default:'' }}" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-600 focus:border-blue-600">
                    {% if form.asset_name.errors %}
                        <div class="text-red-600 text-sm mt-1">{% for error in form.asset_name.errors %}{{ error }}{% endfor %}</div>
                    {% endif %}
                </div>

                <div>
                    <label for="{{ form.unique_identifier.id_for_label }}" class="block text-sm font-medium text-gray-700">Unique Identifier</label>
                    <span id="identifier-label" class="text-sm text-gray-500 block mb-1">Select an asset type to see the required identifier</span>
                    <input id="{{ form.unique_identifier.id_for_label }}" name="{{ form.unique_identifier.html_name }}" type="text" value="{{ form.unique_identifier.value|default:'' }}" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-600 focus:border-blue-600">
                    {% if form.unique_identifier.errors %}
                        <div class="text-red-600 text-sm mt-1">{% for error in form.unique_identifier.errors %}{{ error }}{% endfor %}</div>
                    {% endif %}
                </div>

                <div>
                    <label for="{{ form.details.id_for_label }}" class="block text-sm font-medium text-gray-700">Additional Details (Optional)</label>
                    <textarea id="{{ form.details.id_for_label }}" name="{{ form.details.html_name }}" rows="3" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-600 focus:border-blue-600">{{ form.details.value|default:'' }}</textarea>
                    {% if form.details.errors %}
                        <div class="text-red-600 text-sm mt-1">{% for error in form.details.errors %}{{ error }}{% endfor %}</div>
                    {% endif %}
                </div>
            </div>

            {% if form.non_field_errors %}
                <div class="text-red-600 text-sm p-3 bg-red-50 rounded-lg">
                    {% for error in form.non_field_errors %}{{ error }}{% endfor %}
                </div>
            {% endif %}

            <div class="flex justify-end space-x-4 pt-4">
                <a href="{% url 'employee_overview' %}" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium rounded-lg shadow-sm px-4 py-2 transition duration-200">Cancel</a>
                <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg shadow-lg px-4 py-2 transition duration-200">Add Asset</button>
            </div>
        </form>
    </div>

    <!-- All Assets Table -->
    <div>
        <h3 class="text-2xl font-bold text-gray-800 mb-4">All Assets</h3>
        <p class="text-gray-600 mb-6">List of all assets, their status, and assignment details.</p>
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Asset Name</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Unique Identifier</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Assigned To</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% for asset in all_assets %}
                        <tr class="hover:bg-blue-50 transition duration-200">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{ asset.asset_name }}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ asset.asset_type.name }}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ asset.unique_identifier }}</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                {% if asset.assigned_to %}
                                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">Assigned</span>
                                {% else %}
                                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800">Unassigned</span>
                                {% endif %}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                {% if asset.assigned_to %}
                                    {{ asset.assigned_to.employee_id }} - {{ asset.assigned_to.name }}
                                {% else %}
                                    -
                                {% endif %}
                            </td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="5" class="px-6 py-4 text-center text-sm text-gray-500">No assets found.</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const assetTypeSelect = document.getElementById('id_asset_type');
    const uniqueIdentifierInput = document.getElementById('id_unique_identifier');
    const identifierLabel = document.getElementById('identifier-label');

    function updateIdentifierLabel() {
        const selectedOption = assetTypeSelect.options[assetTypeSelect.selectedIndex];
        if (selectedOption.value) {
            const label = selectedOption.dataset.label || 'Unique Identifier';
            identifierLabel.textContent = label;
            uniqueIdentifierInput.placeholder = `Enter ${label.toLowerCase()}`;
        } else {
            identifierLabel.textContent = 'Select an asset type to see the required identifier';
            uniqueIdentifierInput.placeholder = 'Enter identifier (e.g., IMEI)';
        }
    }

    assetTypeSelect.addEventListener('change', updateIdentifierLabel);
    updateIdentifierLabel(); // Initial call
});
</script>
{% endblock %}
